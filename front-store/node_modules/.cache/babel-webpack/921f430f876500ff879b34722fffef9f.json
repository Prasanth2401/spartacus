{"ast":null,"code":"import * as i0 from '@angular/core';\nimport { Injectable, isDevMode, NgModule } from '@angular/core';\nimport * as i2 from '@spartacus/core';\nimport { Config, facadeFactory, provideDefaultConfigFactory, provideDefaultConfig } from '@spartacus/core';\nimport { Subject, forkJoin, of, from } from 'rxjs';\nimport { take, catchError, switchMap, filter, tap } from 'rxjs/operators';\nimport { OrderEntriesSource, ProductImportStatus, CmsPageGuard, PageLayoutComponent, ORDER_ENTRIES_CONTEXT } from '@spartacus/storefront';\nimport * as i1 from '@angular/router';\nimport { RouterModule } from '@angular/router';\nconst defaultQuickOrderConfig = {\n  quickOrder: {\n    searchForm: {\n      displayProductImages: true,\n      maxProducts: 5,\n      minCharactersBeforeRequest: 3\n    }\n  }\n};\n\nclass QuickOrderConfig {}\n\nQuickOrderConfig.ɵfac = function QuickOrderConfig_Factory(t) {\n  return new (t || QuickOrderConfig)();\n};\n\nQuickOrderConfig.ɵprov = /* @__PURE__ */i0.ɵɵdefineInjectable({\n  token: QuickOrderConfig,\n  factory: function QuickOrderConfig_Factory(t) {\n    let r = null;\n\n    if (t) {\n      r = new (t || QuickOrderConfig)();\n    } else {\n      r = i0.ɵɵinject(Config);\n    }\n\n    return r;\n  },\n  providedIn: 'root'\n});\n\n(function () {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(QuickOrderConfig, [{\n    type: Injectable,\n    args: [{\n      providedIn: 'root',\n      useExisting: Config\n    }]\n  }], null, null);\n})();\n\nconst CART_QUICK_ORDER_FEATURE = 'cartQuickOrder';\nconst CART_QUICK_ORDER_CORE_FEATURE = 'cartQuickOrderCore';\n\nfunction quickOrderFacadeFactory() {\n  return facadeFactory({\n    facade: QuickOrderFacade,\n    feature: CART_QUICK_ORDER_CORE_FEATURE,\n    methods: ['addProduct', 'addToCart', 'clearList', 'canAdd', 'setListLimit', 'getEntries', 'getProductAdded', 'loadEntries', 'softDeleteEntry', 'search', 'searchProducts', 'setProductAdded', 'updateEntryQuantity', 'getSoftDeletedEntries', 'restoreSoftDeletedEntry', 'hardDeleteEntry', 'clearDeletedEntries', 'getNonPurchasableProductError', 'setNonPurchasableProductError', 'clearNonPurchasableProductError']\n  });\n}\n\nclass QuickOrderFacade {}\n\nQuickOrderFacade.ɵfac = function QuickOrderFacade_Factory(t) {\n  return new (t || QuickOrderFacade)();\n};\n\nQuickOrderFacade.ɵprov = /* @__PURE__ */i0.ɵɵdefineInjectable({\n  token: QuickOrderFacade,\n  factory: function () {\n    return quickOrderFacadeFactory();\n  },\n  providedIn: 'root'\n});\n\n(function () {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(QuickOrderFacade, [{\n    type: Injectable,\n    args: [{\n      providedIn: 'root',\n      useFactory: quickOrderFacadeFactory\n    }]\n  }], null, null);\n})();\n\nclass QuickOrderOrderEntriesContext {\n  constructor(quickOrderService, productConnector) {\n    this.quickOrderService = quickOrderService;\n    this.productConnector = productConnector;\n    this.type = OrderEntriesSource.QUICK_ORDER;\n  }\n\n  getEntries() {\n    return this.quickOrderService.getEntries();\n  }\n\n  addEntries(productsData) {\n    const results$ = new Subject();\n    forkJoin(productsData.map(productData => this.productConnector.get(productData.productCode).pipe(take(1), catchError(response => {\n      this.handleErrors(response, productData.productCode, results$);\n      return of(null);\n    })))).pipe(switchMap(products => from(products).pipe(filter(product => !!product), switchMap(product => this.quickOrderService.canAdd(product.code).pipe(take(1), tap(canAdd => {\n      const productData = productsData.find(p => p.productCode === product.code);\n\n      if (canAdd) {\n        this.handleResults(product, productData, results$);\n        this.quickOrderService.addProduct(product, productData.quantity);\n      } else {\n        results$.next({\n          productCode: productData.productCode,\n          statusCode: ProductImportStatus.LIMIT_EXCEEDED\n        });\n      }\n    })))))).subscribe();\n    return results$.pipe(take(productsData.length));\n  }\n\n  handleResults(product, productData, results$) {\n    var _a, _b;\n\n    if (((_a = product.stock) === null || _a === void 0 ? void 0 : _a.stockLevel) && productData.quantity >= product.stock.stockLevel) {\n      results$.next({\n        productCode: productData.productCode,\n        productName: product === null || product === void 0 ? void 0 : product.name,\n        statusCode: ProductImportStatus.LOW_STOCK,\n        quantity: productData.quantity,\n        quantityAdded: product.stock.stockLevel\n      });\n    } else if (((_b = product.stock) === null || _b === void 0 ? void 0 : _b.stockLevelStatus) === 'outOfStock') {\n      results$.next({\n        productCode: productData.productCode,\n        statusCode: ProductImportStatus.NO_STOCK,\n        productName: product === null || product === void 0 ? void 0 : product.name\n      });\n    } else {\n      results$.next({\n        productCode: productData.productCode,\n        statusCode: ProductImportStatus.SUCCESS\n      });\n    }\n  }\n\n  handleErrors(response, productCode, results$) {\n    var _a;\n\n    if (((_a = response === null || response === void 0 ? void 0 : response.error) === null || _a === void 0 ? void 0 : _a.errors[0].type) === 'UnknownIdentifierError') {\n      results$.next({\n        productCode,\n        statusCode: ProductImportStatus.UNKNOWN_IDENTIFIER\n      });\n    } else {\n      if (isDevMode()) {\n        console.warn('Unrecognized cart add entry action type while mapping messages', response);\n      }\n\n      results$.next({\n        productCode,\n        statusCode: ProductImportStatus.UNKNOWN_ERROR\n      });\n    }\n  }\n\n}\n\nQuickOrderOrderEntriesContext.ɵfac = function QuickOrderOrderEntriesContext_Factory(t) {\n  return new (t || QuickOrderOrderEntriesContext)(i0.ɵɵinject(QuickOrderFacade), i0.ɵɵinject(i2.ProductConnector));\n};\n\nQuickOrderOrderEntriesContext.ɵprov = /* @__PURE__ */i0.ɵɵdefineInjectable({\n  token: QuickOrderOrderEntriesContext,\n  factory: QuickOrderOrderEntriesContext.ɵfac,\n  providedIn: 'root'\n});\n\n(function () {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(QuickOrderOrderEntriesContext, [{\n    type: Injectable,\n    args: [{\n      providedIn: 'root'\n    }]\n  }], function () {\n    return [{\n      type: QuickOrderFacade\n    }, {\n      type: i2.ProductConnector\n    }];\n  }, null);\n})();\n\nfunction defaultQuickOrderComponentsConfig() {\n  const config = {\n    featureModules: {\n      [CART_QUICK_ORDER_FEATURE]: {\n        cmsComponents: ['QuickOrderComponent', 'CartQuickOrderFormComponent']\n      },\n      // by default core is bundled together with components\n      [CART_QUICK_ORDER_CORE_FEATURE]: CART_QUICK_ORDER_FEATURE\n    }\n  };\n  return config;\n}\n\nconst defaultQuickOrderRoutingConfig = {\n  routing: {\n    routes: {\n      quickOrder: {\n        paths: ['my-account/quick-order']\n      }\n    }\n  }\n};\n\nclass QuickOrderRootModule {}\n\nQuickOrderRootModule.ɵfac = function QuickOrderRootModule_Factory(t) {\n  return new (t || QuickOrderRootModule)();\n};\n\nQuickOrderRootModule.ɵmod = /* @__PURE__ */i0.ɵɵdefineNgModule({\n  type: QuickOrderRootModule\n});\nQuickOrderRootModule.ɵinj = /* @__PURE__ */i0.ɵɵdefineInjector({\n  providers: [provideDefaultConfigFactory(defaultQuickOrderComponentsConfig), provideDefaultConfig(defaultQuickOrderRoutingConfig), provideDefaultConfig(defaultQuickOrderConfig)],\n  imports: [[RouterModule.forChild([{\n    // @ts-ignore\n    path: null,\n    canActivate: [CmsPageGuard],\n    component: PageLayoutComponent,\n    data: {\n      cxRoute: 'quickOrder',\n      cxContext: {\n        [ORDER_ENTRIES_CONTEXT]: QuickOrderOrderEntriesContext\n      }\n    }\n  }])]]\n});\n\n(function () {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(QuickOrderRootModule, [{\n    type: NgModule,\n    args: [{\n      imports: [RouterModule.forChild([{\n        // @ts-ignore\n        path: null,\n        canActivate: [CmsPageGuard],\n        component: PageLayoutComponent,\n        data: {\n          cxRoute: 'quickOrder',\n          cxContext: {\n            [ORDER_ENTRIES_CONTEXT]: QuickOrderOrderEntriesContext\n          }\n        }\n      }])],\n      providers: [provideDefaultConfigFactory(defaultQuickOrderComponentsConfig), provideDefaultConfig(defaultQuickOrderRoutingConfig), provideDefaultConfig(defaultQuickOrderConfig)]\n    }]\n  }], null, null);\n})();\n/**\n * Generated bundle index. Do not edit.\n */\n\n\nexport { CART_QUICK_ORDER_CORE_FEATURE, CART_QUICK_ORDER_FEATURE, QuickOrderConfig, QuickOrderFacade, QuickOrderOrderEntriesContext, QuickOrderRootModule, defaultQuickOrderComponentsConfig, defaultQuickOrderConfig, defaultQuickOrderRoutingConfig, quickOrderFacadeFactory }; //# sourceMappingURL=spartacus-cart-quick-order-root.js.map","map":{"version":3,"sources":["D:/spartacus/front-store/node_modules/@spartacus/cart/fesm2015/spartacus-cart-quick-order-root.js"],"names":["i0","Injectable","isDevMode","NgModule","i2","Config","facadeFactory","provideDefaultConfigFactory","provideDefaultConfig","Subject","forkJoin","of","from","take","catchError","switchMap","filter","tap","OrderEntriesSource","ProductImportStatus","CmsPageGuard","PageLayoutComponent","ORDER_ENTRIES_CONTEXT","i1","RouterModule","defaultQuickOrderConfig","quickOrder","searchForm","displayProductImages","maxProducts","minCharactersBeforeRequest","QuickOrderConfig","ɵfac","ɵprov","type","args","providedIn","useExisting","CART_QUICK_ORDER_FEATURE","CART_QUICK_ORDER_CORE_FEATURE","quickOrderFacadeFactory","facade","QuickOrderFacade","feature","methods","useFactory","QuickOrderOrderEntriesContext","constructor","quickOrderService","productConnector","QUICK_ORDER","getEntries","addEntries","productsData","results$","map","productData","get","productCode","pipe","response","handleErrors","products","product","canAdd","code","find","p","handleResults","addProduct","quantity","next","statusCode","LIMIT_EXCEEDED","subscribe","length","_a","_b","stock","stockLevel","productName","name","LOW_STOCK","quantityAdded","stockLevelStatus","NO_STOCK","SUCCESS","error","errors","UNKNOWN_IDENTIFIER","console","warn","UNKNOWN_ERROR","ProductConnector","defaultQuickOrderComponentsConfig","config","featureModules","cmsComponents","defaultQuickOrderRoutingConfig","routing","routes","paths","QuickOrderRootModule","ɵmod","ɵinj","forChild","path","canActivate","component","data","cxRoute","cxContext","imports","providers"],"mappings":"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","sourcesContent":["import * as i0 from '@angular/core';\nimport { Injectable, isDevMode, NgModule } from '@angular/core';\nimport * as i2 from '@spartacus/core';\nimport { Config, facadeFactory, provideDefaultConfigFactory, provideDefaultConfig } from '@spartacus/core';\nimport { Subject, forkJoin, of, from } from 'rxjs';\nimport { take, catchError, switchMap, filter, tap } from 'rxjs/operators';\nimport { OrderEntriesSource, ProductImportStatus, CmsPageGuard, PageLayoutComponent, ORDER_ENTRIES_CONTEXT } from '@spartacus/storefront';\nimport * as i1 from '@angular/router';\nimport { RouterModule } from '@angular/router';\n\nconst defaultQuickOrderConfig = {\n    quickOrder: {\n        searchForm: {\n            displayProductImages: true,\n            maxProducts: 5,\n            minCharactersBeforeRequest: 3,\n        },\n    },\n};\n\nclass QuickOrderConfig {\n}\nQuickOrderConfig.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: \"12.0.0\", version: \"12.0.5\", ngImport: i0, type: QuickOrderConfig, deps: [], target: i0.ɵɵFactoryTarget.Injectable });\nQuickOrderConfig.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: \"12.0.0\", version: \"12.0.5\", ngImport: i0, type: QuickOrderConfig, providedIn: 'root', useExisting: Config });\ni0.ɵɵngDeclareClassMetadata({ minVersion: \"12.0.0\", version: \"12.0.5\", ngImport: i0, type: QuickOrderConfig, decorators: [{\n            type: Injectable,\n            args: [{\n                    providedIn: 'root',\n                    useExisting: Config,\n                }]\n        }] });\n\nconst CART_QUICK_ORDER_FEATURE = 'cartQuickOrder';\nconst CART_QUICK_ORDER_CORE_FEATURE = 'cartQuickOrderCore';\n\nfunction quickOrderFacadeFactory() {\n    return facadeFactory({\n        facade: QuickOrderFacade,\n        feature: CART_QUICK_ORDER_CORE_FEATURE,\n        methods: [\n            'addProduct',\n            'addToCart',\n            'clearList',\n            'canAdd',\n            'setListLimit',\n            'getEntries',\n            'getProductAdded',\n            'loadEntries',\n            'softDeleteEntry',\n            'search',\n            'searchProducts',\n            'setProductAdded',\n            'updateEntryQuantity',\n            'getSoftDeletedEntries',\n            'restoreSoftDeletedEntry',\n            'hardDeleteEntry',\n            'clearDeletedEntries',\n            'getNonPurchasableProductError',\n            'setNonPurchasableProductError',\n            'clearNonPurchasableProductError',\n        ],\n    });\n}\nclass QuickOrderFacade {\n}\nQuickOrderFacade.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: \"12.0.0\", version: \"12.0.5\", ngImport: i0, type: QuickOrderFacade, deps: [], target: i0.ɵɵFactoryTarget.Injectable });\nQuickOrderFacade.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: \"12.0.0\", version: \"12.0.5\", ngImport: i0, type: QuickOrderFacade, providedIn: 'root', useFactory: quickOrderFacadeFactory });\ni0.ɵɵngDeclareClassMetadata({ minVersion: \"12.0.0\", version: \"12.0.5\", ngImport: i0, type: QuickOrderFacade, decorators: [{\n            type: Injectable,\n            args: [{\n                    providedIn: 'root',\n                    useFactory: quickOrderFacadeFactory,\n                }]\n        }] });\n\nclass QuickOrderOrderEntriesContext {\n    constructor(quickOrderService, productConnector) {\n        this.quickOrderService = quickOrderService;\n        this.productConnector = productConnector;\n        this.type = OrderEntriesSource.QUICK_ORDER;\n    }\n    getEntries() {\n        return this.quickOrderService.getEntries();\n    }\n    addEntries(productsData) {\n        const results$ = new Subject();\n        forkJoin(productsData.map((productData) => this.productConnector.get(productData.productCode).pipe(take(1), catchError((response) => {\n            this.handleErrors(response, productData.productCode, results$);\n            return of(null);\n        }))))\n            .pipe(switchMap((products) => from(products).pipe(filter((product) => !!product), switchMap((product) => this.quickOrderService.canAdd(product.code).pipe(take(1), tap((canAdd) => {\n            const productData = productsData.find((p) => p.productCode === product.code);\n            if (canAdd) {\n                this.handleResults(product, productData, results$);\n                this.quickOrderService.addProduct(product, productData.quantity);\n            }\n            else {\n                results$.next({\n                    productCode: productData.productCode,\n                    statusCode: ProductImportStatus.LIMIT_EXCEEDED,\n                });\n            }\n        }))))))\n            .subscribe();\n        return results$.pipe(take(productsData.length));\n    }\n    handleResults(product, productData, results$) {\n        var _a, _b;\n        if (((_a = product.stock) === null || _a === void 0 ? void 0 : _a.stockLevel) &&\n            productData.quantity >= product.stock.stockLevel) {\n            results$.next({\n                productCode: productData.productCode,\n                productName: product === null || product === void 0 ? void 0 : product.name,\n                statusCode: ProductImportStatus.LOW_STOCK,\n                quantity: productData.quantity,\n                quantityAdded: product.stock.stockLevel,\n            });\n        }\n        else if (((_b = product.stock) === null || _b === void 0 ? void 0 : _b.stockLevelStatus) === 'outOfStock') {\n            results$.next({\n                productCode: productData.productCode,\n                statusCode: ProductImportStatus.NO_STOCK,\n                productName: product === null || product === void 0 ? void 0 : product.name,\n            });\n        }\n        else {\n            results$.next({\n                productCode: productData.productCode,\n                statusCode: ProductImportStatus.SUCCESS,\n            });\n        }\n    }\n    handleErrors(response, productCode, results$) {\n        var _a;\n        if (((_a = response === null || response === void 0 ? void 0 : response.error) === null || _a === void 0 ? void 0 : _a.errors[0].type) === 'UnknownIdentifierError') {\n            results$.next({\n                productCode,\n                statusCode: ProductImportStatus.UNKNOWN_IDENTIFIER,\n            });\n        }\n        else {\n            if (isDevMode()) {\n                console.warn('Unrecognized cart add entry action type while mapping messages', response);\n            }\n            results$.next({\n                productCode,\n                statusCode: ProductImportStatus.UNKNOWN_ERROR,\n            });\n        }\n    }\n}\nQuickOrderOrderEntriesContext.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: \"12.0.0\", version: \"12.0.5\", ngImport: i0, type: QuickOrderOrderEntriesContext, deps: [{ token: QuickOrderFacade }, { token: i2.ProductConnector }], target: i0.ɵɵFactoryTarget.Injectable });\nQuickOrderOrderEntriesContext.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: \"12.0.0\", version: \"12.0.5\", ngImport: i0, type: QuickOrderOrderEntriesContext, providedIn: 'root' });\ni0.ɵɵngDeclareClassMetadata({ minVersion: \"12.0.0\", version: \"12.0.5\", ngImport: i0, type: QuickOrderOrderEntriesContext, decorators: [{\n            type: Injectable,\n            args: [{\n                    providedIn: 'root',\n                }]\n        }], ctorParameters: function () { return [{ type: QuickOrderFacade }, { type: i2.ProductConnector }]; } });\n\nfunction defaultQuickOrderComponentsConfig() {\n    const config = {\n        featureModules: {\n            [CART_QUICK_ORDER_FEATURE]: {\n                cmsComponents: ['QuickOrderComponent', 'CartQuickOrderFormComponent'],\n            },\n            // by default core is bundled together with components\n            [CART_QUICK_ORDER_CORE_FEATURE]: CART_QUICK_ORDER_FEATURE,\n        },\n    };\n    return config;\n}\nconst defaultQuickOrderRoutingConfig = {\n    routing: {\n        routes: {\n            quickOrder: {\n                paths: ['my-account/quick-order'],\n            },\n        },\n    },\n};\nclass QuickOrderRootModule {\n}\nQuickOrderRootModule.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: \"12.0.0\", version: \"12.0.5\", ngImport: i0, type: QuickOrderRootModule, deps: [], target: i0.ɵɵFactoryTarget.NgModule });\nQuickOrderRootModule.ɵmod = i0.ɵɵngDeclareNgModule({ minVersion: \"12.0.0\", version: \"12.0.5\", ngImport: i0, type: QuickOrderRootModule, imports: [i1.RouterModule] });\nQuickOrderRootModule.ɵinj = i0.ɵɵngDeclareInjector({ minVersion: \"12.0.0\", version: \"12.0.5\", ngImport: i0, type: QuickOrderRootModule, providers: [\n        provideDefaultConfigFactory(defaultQuickOrderComponentsConfig),\n        provideDefaultConfig(defaultQuickOrderRoutingConfig),\n        provideDefaultConfig(defaultQuickOrderConfig),\n    ], imports: [[\n            RouterModule.forChild([\n                {\n                    // @ts-ignore\n                    path: null,\n                    canActivate: [CmsPageGuard],\n                    component: PageLayoutComponent,\n                    data: {\n                        cxRoute: 'quickOrder',\n                        cxContext: {\n                            [ORDER_ENTRIES_CONTEXT]: QuickOrderOrderEntriesContext,\n                        },\n                    },\n                },\n            ]),\n        ]] });\ni0.ɵɵngDeclareClassMetadata({ minVersion: \"12.0.0\", version: \"12.0.5\", ngImport: i0, type: QuickOrderRootModule, decorators: [{\n            type: NgModule,\n            args: [{\n                    imports: [\n                        RouterModule.forChild([\n                            {\n                                // @ts-ignore\n                                path: null,\n                                canActivate: [CmsPageGuard],\n                                component: PageLayoutComponent,\n                                data: {\n                                    cxRoute: 'quickOrder',\n                                    cxContext: {\n                                        [ORDER_ENTRIES_CONTEXT]: QuickOrderOrderEntriesContext,\n                                    },\n                                },\n                            },\n                        ]),\n                    ],\n                    providers: [\n                        provideDefaultConfigFactory(defaultQuickOrderComponentsConfig),\n                        provideDefaultConfig(defaultQuickOrderRoutingConfig),\n                        provideDefaultConfig(defaultQuickOrderConfig),\n                    ],\n                }]\n        }] });\n\n/**\n * Generated bundle index. Do not edit.\n */\n\nexport { CART_QUICK_ORDER_CORE_FEATURE, CART_QUICK_ORDER_FEATURE, QuickOrderConfig, QuickOrderFacade, QuickOrderOrderEntriesContext, QuickOrderRootModule, defaultQuickOrderComponentsConfig, defaultQuickOrderConfig, defaultQuickOrderRoutingConfig, quickOrderFacadeFactory };\n//# sourceMappingURL=spartacus-cart-quick-order-root.js.map\n"]},"metadata":{},"sourceType":"module"}